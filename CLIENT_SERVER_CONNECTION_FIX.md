# ?? Client ??? Server ???? - ??????

## ????

```
Client: ? ????
Server: ? ?????
Result: ? Server ?????? ? Timeout
```

?????
```
[CONNECT] New client connected: 192.168.x.x:xxxxx
[RECV RAW] 192.168.x.x: {"Type":"LoginPacket",...}
[???] LoginResultPacket ????? Client ???
[??] Client ?? 10 ?? ? Timeout
```

---

## ??????

### Windows Firewall ????

??????Windows Firewall ????????? **? Inbound ??**?
- ? **Inbound**: `ChatAppServer` - ?? Client ????
- ? **Outbound**: `ChatAppServer (Out)` - **????** Server ??????

### ????

```
???????????????                         ???????????????
?   Client    ?                         ?   Server    ?
?  192.x.x.1  ? ??? TCP Port 9000 ???  ? 192.x.x.2   ?
?             ?  (Inbound Rule ?)      ?             ?
?             ?                         ?             ?
?             ? ??? TCP Port 9000 ??? ?             ?
?             ?  (Outbound Rule ?)     ?             ?
???????????????                         ???????????????
    BLOCK!                              Firewall
```

Server ? Firewall ??????? Outbound ??????????????

---

## ?? ??????

### Step 1: ? Admin ???? Server

**??**: Server ?? Admin ???????????

#### ?? A: ??????????
```bash
# ??????
RunServerAsAdmin.bat
```
??????? Admin ??????? Server?

#### ?? B: ??? Admin ??
```
1. ? Windows ? + ?? "cmd"
2. ???? "?????" ? "????????"
3. ??????
4. ??: dotnet run --project ChatAppServer/ChatAppServer.csproj
```

#### ?? C: ?? Admin ????
```
1. ???? ChatAppServer.csproj ? ??? ? ??????????
2. ???????? ? ?? ? ??
3. ?? "????????"
4. ?????????????
```

---

### Step 2: Server ????????????

? Server ? Admin ????????????

```
[???]
[OpenPortAsAdmin] Launching PowerShell: C:\Users\Admin\AppData\Local\Temp\open_firewall_8e526c20.ps1
[OpenPortAsAdmin] PowerShell exit code: 0
[OpenPortAsAdmin] Waiting 3 seconds for Windows Firewall to sync...
[IsPortOpen] Attempt 1/5: Inbound=True, Outbound=True
? Firewall port 9000 successfully opened and verified!
? Firewall port 9000 successfully opened and verified!
Server ?????: 9000
```

### Step 3: ????????

?? PowerShell?Admin?????
```powershell
Get-NetFirewallRule -DisplayName "ChatAppServer*" | 
    Select DisplayName, Direction, Action, Enabled | 
    Format-Table -AutoSize
```

?????
```
DisplayName            Direction Action Enabled
-----------            --------- ------ -------
ChatAppServer          Inbound   Allow  True
ChatAppServer (Out)    Outbound  Allow  True
```

---

## ?? ????

### 1. Server ??Admin ???
```bash
# ??1: ??????
.\RunServerAsAdmin.bat

# ??2: ?? Admin CMD
dotnet run --project ChatAppServer/ChatAppServer.csproj
```

?????
```
? Firewall port 9000 successfully opened and verified!
Server ?????: 9000
```

### 2. Client ???????
```bash
dotnet run --project ChatAppClient/ChatAppClient.csproj
```

### 3. ????

- **Server IP**: `127.0.0.1` (??) ? Server ??? IP
- **Port**: `9000`
- **User**: `admin`
- **Pass**: `123456`

?????
```
[Client] ? ???
[Server] ? [CONNECT] New client connected
[Client] ??????
[Server] ? [RECV RAW] LoginPacket ??
[Server] ? [LOGIN] User 'admin' logged in
[Client] ? ?????? ? ?????
```

---

## ? ??????

### Q1: "PowerShell exit code: 1"

**??**: Server ?????????

**??**: Server ??? Admin ????

**??**:
```
? ???? CMD/PowerShell ? "????????"
? ??? RunServerAsAdmin.bat
```

### Q2: "Outbound rule not found"

**??**: ???? `Outbound=False`

**??**: PowerShell ??????? Server ? Admin ??

**??**: ??????
```powershell
New-NetFirewallRule -DisplayName "ChatAppServer (Out)" `
    -Direction Outbound `
    -Action Allow `
    -Protocol TCP `
    -LocalPort 9000 `
    -RemoteAddress Any `
    -Profile Domain,Private,Public `
    -Enabled $true
```

### Q3: Client ????

**???? 1**: ???????
```powershell
# ????
Get-NetFirewallRule -DisplayName "ChatAppServer (Out)" | 
    Get-NetFirewallAddressFilter
# ????: RemoteAddress : Any
```

**???? 2**: Firewall Profile ??
- Windows Firewall ? 3 ? Profile: Domain, Private, Public
- ????????? Profile (?????)

**???? 3**: Server ? TCP/IP ??
```cmd
# ?? Server ??????? 9000
netstat -ano | findstr :9000
```

---

## ?? ???????

### ????

```bash
# 1. ???? Server (?? Admin)
?? RunServerAsAdmin.bat

# 2. ?? "? Firewall port 9000 successfully opened" ?
# 3. ????? Terminal ?? Client
dotnet run --project ChatAppClient/ChatAppClient.csproj

# 4. ??????
Server: 127.0.0.1 (??? IP)
Port: 9000
User: admin
Pass: 123456

# 5. ???? ? ?????
```

---

## ?? ?????

```
Client                          Server
  ?                               ?
  ??????[????]??????????????? ?
  ?                          (Inbound ?)
  ?                               ?
  ?                          [????]
  ?                          [????]
  ?                               ?
  ?                          [????]
  ???????[????]????????????????
       (Outbound ? - ????!)
  ?                               ?
  ?????[????]??????????????????
```

---

## ????

| ?? | ?? |
|------|------|
| `RunServerAsAdmin.bat` | **??**: ??? Admin ?? Server |
| `OpenFirewall.bat` | ????????? |
| `DebugFirewallRules.ps1` | ????????? |
| `CheckFirewallRuleDetails.bat` | ???????? |
| `TestPowerShellFirewall.bat` | ?? PowerShell ???? |
| `SERVER_FIREWALL_SETUP_GUIDE.md` | ?????? |

---

## ?? ????

1. **? Server ??? Admin ????** ? ?????????
2. **? ??????** ? Inbound (????) + Outbound (????)
3. **? ?? 3 ? Profile** ? Domain, Private, Public
4. **? RemoteAddress = Any** ? Outbound ??????

---

## ?? ????

```bash
# ???????
1. ?? RunServerAsAdmin.bat
2. ?? "? Firewall port 9000 successfully opened"
3. ?? Client ? ?? ? ???
```

**?????????????** ?
