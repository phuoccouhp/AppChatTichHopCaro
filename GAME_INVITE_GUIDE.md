# ?? H??NG D?N S? D?NG CH?C N?NG G?I YÊU C?U CH?I GAME

## ?? Cách G?i Yêu C?u Ch?i Game

### 1. **Ch?i Caro** (C? Caro)

**B??c 1**: M? h?p tho?i chat v?i b?n bè
- Nh?p vào b?n bè trong danh sách bên trái

**B??c 2**: Nh?n nút "??" (nút Ch?i Game)
- Nút này n?m bên trên khung nh?p tin nh?n
- M?t menu context s? hi?n th? 2 l?a ch?n

**B??c 3**: Ch?n "Ch?i Caro"
- Yêu c?u s? ???c g?i ngay l?p t?c
- Nút "??" s? chuy?n sang tr?ng thái "..." (?ang ch? ph?n h?i)

**B??c 4**: Ch? b?n ph?n h?i
- B?n s? nhìn th?y m?t "bubble" (bong bóng tin nh?n) v?i thông tin l?i m?i
- B?n có th? nh?n "? Ch?p nh?n" ho?c "? T? ch?i"

---

### 2. **Ch?i Tank Game** (Game Tank)

Quy trình t??ng t? nh? Caro:

**B??c 1-2**: M? chat và nh?n nút "??"

**B??c 3**: Ch?n "Ch?i Tank Game"
- Yêu c?u s? ???c g?i ngay l?p t?c

**B??c 4**: Ch? b?n ph?n h?i
- N?u ch?p nh?n, game Tank s? kh?i ??ng
- N?u t? ch?i, bubble s? hi?n th? "? ?ã t? ch?i"

---

## ?? Quy Trình Chi Ti?t

### Phía Ng??i G?i L?i M?i:
1. Nh?n nút "??" ? Ch?n lo?i game
2. Nút chuy?n sang tr?ng thái "..." (vô hi?u hóa)
3. Nhìn th?y game invite bubble trong chat hi?n th?:
   - "B?n m?i [Tên B?n] ch?i Caro"
   - Bubble s? c?p nh?t khi b?n ph?n h?i
4. N?u b?n ch?p nh?n:
   - Game s? kh?i ??ng ngay
   - Bubble hi?n th? "? ?ã ch?p nh?n"
5. N?u b?n t? ch?i:
   - Bubble hi?n th? "? ?ã t? ch?i"
   - Nút "??" ???c reset, có th? m?i l?i

### Phía Ng??i Nh?n L?i M?i:
1. Nh?n bubble game invite trong chat
2. Có 2 nút l?a ch?n:
   - ? (Ch?p nh?n) - Game s? kh?i ??ng
   - ? (T? ch?i) - L?i m?i b? t? ch?i
3. Bubble s? c?p nh?t tr?ng thái ngay l?p t?c
4. N?u ?ã t? ch?i, ng??i g?i có th? m?i l?i (ch?n nút "M?i l?i" trên bubble)

---

## ? C?i Ti?n T?c ?? (v1.2)

### Nh?ng T?i ?u Hóa ?ã Áp D?ng:

1. **Buffer Size T?ng Lên**
   - Client: 128 KB (thay vì m?c ??nh 64 KB)
   - Server: 128 KB (thay vì m?c ??nh 64 KB)
   - **L?i ích**: Gi?m s? l?n system calls, nh?n tin nh?n nhanh h?n

2. **TCP_NODELAY B?t**
   - C? client và server ??u kích ho?t
   - **L?i ích**: Gi?m latency cho gói tin nh? (chat messages)

3. **Buffer Reuse** (Tái S? D?ng Buffer)
   - Không t?o buffer m?i m?i l?n
   - **L?i ích**: Gi?m GC pressure, gi?m memory allocation

4. **MemoryStream Read-Only**
   - Deserialize vào MemoryStream không th? ghi
   - **L?i ích**: Gi?m memory copying

5. **Async/Await T?i ?u**
   - X? lý packet ngay mà không delay
   - **L?i ích**: Tin nh?n ???c g?i li?n k? nhau

---

## ?? Troubleshooting

### V?n ??: Nút "??" Không Ph?n ?ng
**Gi?i pháp**:
- Ki?m tra k?t n?i m?ng
- ??m b?o b?n ?ã ??ng nh?p
- Th? t?i l?i ?ng d?ng

### V?n ??: L?i M?i Không ???c G?i
**Gi?i pháp**:
- Ki?m tra xem b?n bè có online không
- Ki?m tra k?t n?i server (xem tiêu ?? c?a s?)
- Ki?m tra t??ng l?a có ch?n port 9000 không

### V?n ??: Game Kh?i ??ng Ch?m
**Gi?i pháp**:
- Sau khi nh?n "? ?ã ch?p nh?n", ch? 1-2 giây
- Game s? kh?i ??ng t? ??ng
- N?u không, th? g?i l?i m?i l?i

---

## ?? Hi?u N?ng

**Tr??c t?i ?u hóa**:
- Latency tin nh?n: ~200-500ms
- ?? tr? game invite: ~300-800ms

**Sau t?i ?u hóa (v1.2)**:
- Latency tin nh?n: ~50-150ms (tùy m?ng)
- ?? tr? game invite: ~100-300ms (tùy m?ng)

---

## ?? M?o

1. **N?u mu?n m?i l?i sau khi t? ch?i**:
   - Bubble s? có nút "M?i l?i"
   - Nh?n nút này ?? g?i yêu c?u m?i

2. **Xem l?ch s? game invites**:
   - T?t c? game invites s? ???c l?u trong chat history
   - Có th? xem ai m?i b?n ch?i

3. **H?y game**:
   - N?u c? hai ?ã accept, game s? kh?i ??ng
   - ?? ng?t game, b?m nút "Thoát" trong game form

---

**Version**: 1.2 (Optimized)  
**Last Updated**: 2024  
**Status**: ? ?ang Ho?t ??ng
